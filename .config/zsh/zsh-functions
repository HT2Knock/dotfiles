#!/usr/bin/zsh

function zsh_add_file() {
    [ -f "$ZDOTDIR/$1" ] && source "$ZDOTDIR/$1"
}

function start_ssh() {
    if [ -n "$SSH_AGENT_PID" ]; then
        echo "ssh-agent is already running"
    else
        eval $(ssh-agent -s)
    fi

    ssh-add $1 >/dev/null 2>&1
}

function mem_look() {
    free -h | awk '/Gi$/ {print $1, $3, "/", $2}'
}

function generate_empty_ssh() {
    [ -d $1 ] || mkdir -p $1

    ssh-keygen -b 2048 -t rsa -f $1 -q -N ""
}

function killport() {
    kill $(lsof -t -i :$1)
    echo "Port $1 killed"
}

function y() {
    local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
    yazi "$@" --cwd-file="$tmp"
    if cwd="$(command cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
        builtin cd -- "$cwd"
    fi
    rm -f -- "$tmp"
}

function jtoday() {
    local notes_dir=~/workspace/github.com/T2Knock/JT-notes

    if [[ ! -d "$notes_dir" ]]; then
        echo "Error: Notes directory not found at $notes_dir" >&2
        return 1
    fi

    pushd "$notes_dir" >/dev/null || return 1

    nvim \
        +":lua require('lazy').load({plugins = {'obsidian.nvim'}})" \
        +":Obsidian today"

    popd >/dev/null || return 1
}
